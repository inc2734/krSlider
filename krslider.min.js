/**
 * Plugin Name: KrSlider
 * Description: シンプルなスライドショーを実装するjQueryプラグイン
 * Version: 1.0.0
 * Author: Takashi Kitajima
 * Author URI: http://2inc.org
 * Created : March 25, 2014
 * Modified:
 * License: GPL2
 */
;(function(a){a.fn.krslider=function(b){var c={type:"fade",duration:800,interval:3000,easing:"swing",showNav:false,navStyle:"string",showCaption:false,showPrevNextNav:false,prev_text:"&laquo;",next_text:"&raquo;",maxWidth:0,maxHeight:0,autoResize:false,theme:false,afterMove:function(){}};b=a.extend(c,b);return this.each(function(){var j=a(this);if(b.theme){j.addClass("krslider-theme-"+b.theme)}j.wrapInner('<div class="krslider-wrapper" />');var e=j.find(".krslider-wrapper");e.wrapInner('<div class="krslider-inner" />');var s=j.find(".krslider-inner");var p=s.children();var l=p.length;var g=null;var f=false;var h=0;var n=0;var d;var r=[];if(b.showCaption===true){s.after(a('<div class="krslider-caption-wrapper" />'));var k=e.find(".krslider-caption-wrapper")}if(b.showNav===true&&p.length>1){s.after('<div class="krslider-nav" />');var o=e.find(".krslider-nav")}if(b.showPrevNextNav===true&&p.length>1){s.after('<div class="krslider-prev-next-nav" />');var q=e.find(".krslider-prev-next-nav")}e.addClass(b.type);if(b.autoResize===true){e.addClass("auto-resize");a(window).resize(function(){m.setInnerSize()})}a(window).load(function(){var v=[];p.each(function(x,A){a(A).css("position","absolute");if(m.isYoutube(a(A))){a(A).attr("id","youtube-"+x).append('<div id="youtube-iframe-'+x+'" />');v[x]=a(A)}var w=("ontouchstart" in window);var z;var y;a(A).on("mousedown touchstart",function(C){if(!w){C.preventDefault()}else{z=C.originalEvent.touches[0].clientY}var B=(w)?C.originalEvent.changedTouches[0].pageX:C.pageX;a(this).data("touch-start",B)});a(A).on("mousemove touchmove",function(B){if(w){y=B.originalEvent.touches[0].clientY;if(Math.abs(z-y)<5){B.preventDefault()}}else{B.preventDefault()}if(a(this).data("touch-start")){a(this).data("touch-move",true)}});a(A).on("mouseup touchend",function(F){if(!w){F.preventDefault()}if(a(this).data("touch-move")){if(f===false&&l>1){var E=a(this).data("touch-start");var D=(w)?F.originalEvent.changedTouches[0].pageX:F.pageX;var B="next";if(E<D){B="prev"}var C=(h+1)%l;if(B=="prev"){C=h%l-1}if(B=="prev"&&b.type=="slide"){d="left"}m.lotation(C)}}a(this).removeData("touch-start");if(w){a(this).removeData("touch-move")}});a(A).click(function(){if(a(this).data("touch-move")){a(this).removeData("touch-move");return false}a(this).removeData("touch-move")})});if(v.length){var t=document.createElement("script");t.src="//www.youtube.com/iframe_api";var u=document.getElementsByTagName("script")[0];u.parentNode.insertBefore(t,u);window.onYouTubeIframeAPIReady=function(){for(var w in v){var x=m.getYoutubeId(v[w]);r[w]=new YT.Player("youtube-iframe-"+w,{height:"390",width:"640",videoId:x})}}}if(typeof o!=="undefined"){m.createSliderNav();o.find("ul li").on("click touchend",function(){if(!a(this).hasClass("cur")&&f===false&&l>1){var w=a(this).data("key");if(w<h&&b.type=="slide"){d="left"}m.lotation(w)}})}if(typeof q!=="undefined"){m.createPrevNextNav();q.find("ul li").on("click touchend",function(){if(f===false&&l>1){var w=a(this).data("key");if(a(this).hasClass("nav-prev")&&b.type=="slide"){d="left"}m.lotation(w)}})}m.setInnerSize();switch(b.type){case"slide":d="right";p.each(function(w,x){a(x).css("left",-w*s.width()).show()});break;case"fade":default:}m.start(1)});var m={start:function(t){m.showCaption(t-1);m.setCurrentClass(t-1);if(l>1&&b.interval>0){g=setTimeout(function(){m.lotation(t)},b.interval)}},lotation:function(t){clearTimeout(g);switch(b.type){case"slide":m.type.slide(t,d);break;case"fade":default:m.type.fade(t)}},type:{fade:function(t){m.processBeforeMove(t,function(){f=true;p.fadeOut(b.duration);p.eq(t).fadeIn(b.duration,b.easing,function(){m.processAfterMove(t)})})},slide:function(t,u){m.processBeforeMove(t,function(){n++;f=true;p.eq(t).css("z-index",n);switch(u){case"left":var w=-s.width();var v="+=";d="right";break;case"right":var w=+s.width();var v="-=";break}p.eq(t).css("left",w);p.each(function(x,y){a(y).stop(true,true).animate({left:v+s.width()},b.duration,b.easing,function(){if(x===0){m.processAfterMove(t)}})})})}},processBeforeMove:function(t,u){if(typeof k!=="undefined"){k.css("z-index",n+2)}if(typeof o!=="undefined"){o.css("z-index",n+2)}if(typeof q!=="undefined"){q.css("z-index",n+2)}if(b.showCaption===true){k.stop(true,true).fadeOut(b.duration,function(){a(this).hide()})}u()},processAfterMove:function(u){for(var t in r){r[t].stopVideo()}f=false;h=u;if(typeof q!=="undefined"){m.setNavPrevKey();m.setNavNextKey()}b.afterMove();u++;var v=u%l;if(j.data("krslider:stop")!==true){m.start(v)}},setNavPrevKey:function(t){q.find("ul li.nav-prev").data("key",h%l-1)},setNavNextKey:function(t){q.find("ul li.nav-next").data("key",(h+1)%l)},setCurrentClass:function(t){if(typeof o!=="undefined"){o.find("ul li").removeClass("cur").eq(t).addClass("cur")}},setInnerSize:function(){s.css({height:"",width:""});s.children("*:not(img)").css({height:"",width:""});var v=p.eq(0).width();var t=p.eq(0).height();if(b.maxWidth){if(b.maxWidth>e.width()){v=e.width()}else{v=b.maxWidth}t=Math.floor(b.maxHeight*v/b.maxWidth)}s.css({height:t,width:v});var u=0;var w="";if(j.width()<s.width()){u=s.width()-j.width();w=-u/2}s.children("*:not(img)").css({height:t,width:v})},showCaption:function(v){if(b.showCaption===true){var u=p.eq(v);var w=u.data("caption");var x="";if(w){x=a("#"+w).html()}else{if(u.attr("title")){x=u.attr("title")}else{if(u.attr("alt")){x=u.attr("alt")}}}if(x){var t=a("<span />").append(x);k.hide().html(t).stop(true,true).fadeIn(b.duration,function(){a(this).show()})}}},createSliderNav:function(){o.append(a("<ul />"));p.each(function(u,v){if(b.navStyle=="string"){var t=(u+1)}else{if(b.navStyle=="image"){var x="";var z=a(v).data("thumbnail");if(typeof z!=="undefined"){if(typeof a("#"+z).get(0)!=="undefined"){if(a("#"+z).get(0).nodeName=="IMG"){x=a("#"+z).attr("src")}}}if(!x){if(v.nodeName=="IMG"){x=s.children().eq(u).attr("src")}else{if(v.nodeName=="A"){x=s.children().eq(u).children().attr("src")}else{if(m.isYoutube(a(v))){var y=m.getYoutubeId(a(v));if(y!==null){x="//img.youtube.com/vi/"+y+"/2.jpg"}}}}}if(x){var t=a("<img />").attr({src:x,alt:u+1})}else{var t=a("<div />").html(u+1)}t.addClass("nav-thumbnail")}}if(typeof t!=="undefined"){var w=a("<li />").addClass("nav-"+(u+1)).data("key",(u)).append(t);if(m.isYoutube(a(v))){w.addClass("nav-youtube")}o.find("ul").append(w)}})},createPrevNextNav:function(){q.append(a("<ul />"));var u=["prev","next"];for(i=0;i<u.length;i++){var t=b[u[i]+"_text"];var v=a("<li />").addClass("nav-"+u[i]).append(t);q.find("ul").append(v);m.setNavPrevKey();m.setNavNextKey()}},isYoutube:function(t){if(t.hasClass("youtube")&&typeof t.data("uri")!=="undefined"){return true}},getYoutubeId:function(t){if(!m.isYoutube(t)){return}var u=t.data("uri").match(/www\.youtube\.com\/watch\?v=([^&#]*)/);if(u!==null){return u[1]}}}})}})(jQuery);